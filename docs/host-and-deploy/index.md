---
title: Размещение и развертывание Blazor
author: guardrex
description: Узнайте, как размещать и развертывать приложения Blazor с использованием ядра ASP.NET, сетей доставки контента (CDN), файловых серверов и страниц GitHub.
manager: wpickett
ms.author: riande
ms.custom: mvc
ms.date: 04/16/2018
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: client-side/blazor/host-and-deploy/index
---
# Размещение и развертывание Blazor

От [Luke Latham](https://github.com/guardrex), [Rainer Stropek](https://www.timecockpit.com) и [Daniel Roth](https://github.com/danroth27)

[!INCLUDE[](~/includes/blazor-preview-notice.md)]

## Публикация приложения

Приложения Blazor публикуются для развертывания в конфигурации Release с помощью команды [dotnet publish](https://docs.microsoft.com/dotnet/core/tools/dotnet-publish). IDE может обрабатывать выполнение команды `dotnet publish` автоматически, используя встроенные функции публикации, поэтому может не потребоваться вручную выполнить команду из командной строки в зависимости от используемых инструментов разработки. 

```console
dotnet publish -c Release
```

`dotnet publish` запускает [восстановление](https://docs.microsoft.com/dotnet/core/tools/dotnet-restore) зависимостей проекта и [builds](https://docs.microsoft.com/dotnet/core/tools/dotnet-build) перед созданием файлов для развертывания. Как часть процесса сборки, неиспользуемые методы и сборки удаляются, чтобы уменьшить размер загрузки приложения и время загрузки. Развертывание создается в каталоге */bin/Release/&lt;target-framework&gt;/publish*.

Содержимое в каталоге *publish* развертываются на веб-сервере. Развертывание может быть ручным или автоматизированным процессом в зависимости от используемых инструментов разработки.

## Переписать URL-адреса для правильной маршрутизации

Запросы маршрутизации для компонентов страницы в клиентском приложении не так просты, как запросы на маршрутизацию на серверное, размещенное приложение. Рассмотрим клиентское приложение с двумя страницами:

* **_Main.cshtml_** &ndash; Загружает корневое приложение и содержит ссылку на страницу О сайте (`href="About"`).
* **_About.cshtml_** &ndash; Страница О сайте.

Когда запрашивается документ по умолчанию приложения, используя адресную строку браузера (например, `https://www.contoso.com/`):

1. Браузер делает запрос.
1. Возвращается страница по умолчанию, которая обычно *index.html*.
1. *index.html* загружает приложение.
1. Маршрутизатор Blazor загружается и Razor страница `Main` (*Main.cshtml*) отображается.

На главной странице, выбрав ссылку на страницу `О сайте`, загружается страница `О сайте`. Выбор ссылки на странице `О сайте` работает на клиенте, потому что маршрутизатор Blazor запрещает браузеру делать запрос в Интернете на `www.contoso.com` для `О сайте` и обслуживает страницу внутри себя. Все запросы для внутренних страниц *в клиентском приложении* работают одинаково: запросы не вызывают запросы на основе браузера на серверные ресурсы в Интернете. Маршрутизатор обрабатывает запросы внутренне.

Если запрос выполняется с помощью адресной строки браузера для `www.contoso.com/About`, запрос не выполняется. Такой ресурс не существует на интернет-хосте приложения, поэтому возвращается ответ *404 Не найдено*.

Поскольку браузеры запрашивают интернет-хосты для клиентских страниц, веб-серверы и службы хостинга должны переписывать все запросы на ресурсы, не физически находящиеся на сервере, на страницу *index.html*. Когда возвращается *index.html*, клиентский маршрутизатор приложения берет обработку на себя и возвращает правильный ресурс.

## Базовый путь приложения

Основной путь к приложению - это корневой путь виртуального приложения на сервере. Например, приложение, которое находится на сервере Contoso в виртуальной папке `CoolBlazorApp/`, достигается по адресу `https://www.contoso.com/CoolBlazorApp` и имеет виртуальный базовый путь `CoolBlazorApp/`. Установив базовый путь приложения к `CoolBlazorApp/`, приложение узнает, где оно фактически находится на сервере. Приложение может использовать базовый путь приложения для создания URL-адресов относительно корня приложения из компонента, который не находится в корневом каталоге. Это позволяет компонентам, которые существуют на разных уровнях структуры каталогов, создавать ссылки на другие ресурсы в местах приложения. Базовый-путь к приложению также используется для перехвата кликов по гиперссылкам, где цель `href` ссылки находится в пространстве URI базового пути приложения; маршрутизатор Blazor обрабатывает внутреннюю навигацию.

Во многих сценариях хоста виртуальный путь сервера к приложению является корнем приложения. В этих случаях базовый путь к приложению - пустая строка, которая является стандартной конфигурацией для приложения Blazor. В других сценариях хостинга, таких как виртуальные каталоги GitHub Pages и IIS, базовый путь приложения должен быть установлен на виртуальный путь сервера к приложению. Чтобы установить базовый путь приложения Blazor, добавьте или обновите тег **&lt;base&gt;** в *index.html* в теге **&lt;head&gt;**. Установите значение атрибута `href` в `<virtual-path>/` (требуется конечная косая черта), где `<virtual-path>/` является полным корневым корнем виртуального приложения на сервере для приложения.

## Модели развертывания

Существуют две модели развертывания для приложений Blazor:

* [Развёртывание с помощью ASP.NET Core](#развертывание-с-помощью-aspnet-core) &ndash; Развертывание использует приложение ASP.NET Core на сервере для размещения приложения Blazor.
* [Автономное развёртывание](#автономное-развертывание) &ndash; Автономное развертывание размещает приложение Blazor на статичном веб-сервере или службе, где .NET не используется для обслуживания приложения Blazor.

### Развертывание с помощью ASP.NET Core

В развертывании приложение ASP.NET Core обрабатывает одностраничную маршрутизацию приложений и хостинг приложений Blazor. Опубликованное приложение ASP.NET Core вместе с одним или несколькими приложениями Blazor, которые он размещает, развертывается на веб-сервере или в сервисе хостинга.

Чтобы разместить приложение Blazor, приложение ASP.NET Core должно:

* Включать Blazor приложение.
* Содержать пакет [Microsoft.AspNetCore.Blazor.Server](https://www.nuget.org/packages/Microsoft.AspNetCore.Blazor.Server/) в файлах проекта.
* Иметь настроеный хостинг приложений Blazor с помощью марширения метода `UseBlazor` в [IApplicationBuilder](https://docs.microsoft.com/dotnet/api/microsoft.aspnetcore.builder.iapplicationbuilder) в `Startup.Configure`.

```csharp
public void Configure(IApplicationBuilder app, IHostingEnvironment env)
{
    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
    }

    app.UseBlazor<Client.Program>();
}
```

Метод расширения `UseBlazor` выполняет следующую задачу:

* Конфигурирует [Static File Middleware](https://docs.microsoft.com/aspnet/core/fundamentals/static-files) для обслуживания статических активов Blazor из папки *dist*. В среде разработки хранятся файлы в папке *wwwroot*.
* Настраивает одностраничную маршрутизацию приложений для запросов ресурсов, которые не предназначены для реальных файлов, существующих на диске. Приложение обслуживает документ по умолчанию (*wwwroot/index.html*) для любого запроса, который не был обработан предыдущим экземпляром промежуточного статического файла. Например, запрос на получение страницы из приложения, который должен обрабатываться маршрутизатором Blazor на клиенте, переписывается в запрос на странице *wwwroot/index.html*.

Когда опубликовано приложение ASP.NET Core, приложение Blazor входит в опубликованный каталог, поэтому приложение ASP.NET Core и приложение Blazor могут быть развернуты вместе. Для получения дополнительной информации о хостинге и развертывании основного приложения ASP.NET смотрите [Host and deploy ASP.NET Core](https://docs.microsoft.com/aspnet/core/host-and-deploy).

Информацию о развертывании в Azure App Service смотрите в следующих разделах:

[Publish to Azure with Visual Studio](https://docs.microsoft.com/aspnet/core/tutorials/publish-to-azure-webapp-using-vs)  
Узнайте, как опубликовать приложение Blazor с поддержкой Core для Azure App Service с помощью Visual Studio.

[Publish to Azure with CLI tools](https://docs.microsoft.com/aspnet/core/tutorials/publish-to-azure-webapp-using-cli)  
Узнайте, как публиковать приложение ASP.NET Core в Azure App Service, используя клиент командной строки Git.

### Автономное развертывание

При автономном развертывании на сервер или службу хостинга развертывается только клиентское приложение Blazor. Серверное приложение ASP.NET Core не используется для размещения приложения Blazor. Статические файлы приложения Blazor запрашиваются браузером непосредственно с веб-сервера или службы статического файла.

При развертывании автономного приложения Blazor из опубликованной *dist* папки любой веб-сервер или служба хостинга, которая обслуживает статические файлы, может работать с приложенями Blazor.

#### IIS

IIS - это статический файловый сервер для приложений Blazor. Чтобы настроить IIS на размещение Blazor, смотрите [Создайте статический веб-сайт в IIS](https://docs.microsoft.com/iis/manage/creating-websites/scenario-build-a-static-website-on-iis).

Опубликованные активы создаются в каталоге *\\bin\\Release\\&lt;target-framework&gt;\\publish*. Содержимое каталога *publish* размещается на веб-сервере или хостинге.

**web.config**

Когда проект Blazor публикуется, создается файл *web.config* со следующей конфигурацией IIS:

* Типы MIME установлены для следующих расширений файлов:
  - *\*.dll*: `application/octet-stream`
  - *\*.json*: `application/json`
  - *\*.wasm*: `application/wasm`
  - *\*.woff*: `application/font-woff`
  - *\*.woff2*: `application/font-woff`
* HTTP-сжатие включено для следующих типов MIME:
  - `application/octet-stream`
  - `application/wasm`
* Правила перезаписи URL-адреса установлены:
  - Подавать подкаталог, где расположены статические активы приложения (*&lt;assembly_name&gt;\\dist\\&lt;path_requested&gt;*).
  - Создавать резервную маршрутизацию SPA, чтобы запросы на нефайловые активы перенаправлялись к документу по умолчанию приложения в папке статических ресурсов (*&lt;assembly_name&gt;\\dist\\index.html*).

**Установка модуля перезаписи URL-адресов**

[Модуль перезаписи URL-адресов](https://www.iis.net/downloads/microsoft/url-rewrite) требуется чтобы переписывать URL-адреса. Модуль не установлен по умолчанию, и он недоступен для установки в качестве службы роли веб-сервера (IIS). Модуль должен быть загружен с веб-сайта IIS. Используйте установщик веб-платформы для установки модуля:

1. Перейдите к [Страница загрузки модуля перезаписи URL-адреса](https://www.iis.net/downloads/microsoft/url-rewrite#additionalDownloads). Для английской версии выберите **WebPI** для загрузки установщика WebPI. Для других языков выберите соответствующую архитектуру для сервера (x86/x64) для загрузки установщика.
1. Скопируйте установщик на сервер. Запустите программу установки. Выберите кнопку **Install** и примите условия лицензии. После завершения установки перезагрузка сервера не требуется.

**Настройка веб-сайта**

Установите  **физический путь** веб-сайта в папку приложения Blazor. Папка содержит:

* Файл *web.config*, который IIS использует для настройки веб-сайта, включая необходимые правила переадресации и типы файлов.
* Папка статических файлов приложения.

**Исправление проблем**

Если получена *500 Internal Server Error* и диспетчер IIS выдает ошибки при попытке получить доступ к настройке веб-сайта, убедитесь, что установлен модуль перезаписи URL-адресов. Когда модуль не установлен, файл *web.config* не может быть проанализирован IIS. Это не позволяет диспетчеру IIS загружать конфигурацию веб-сайта и веб-сайт из службы статических файлов Blazor.

Дополнительные сведения об устранении неполадок при развертывании в IIS смотрите [Устранение неполадок в ASP.NET Core на IIS](https://docs.microsoft.com/aspnet/core/host-and-deploy/iis/troubleshoot).

#### Nginx

Следующий файл *nginx.conf* упрощен, чтобы показать, как настроить Nginx для отправки файла *Index.html* всякий раз, когда он не может найти соответствующий файл на диске.

```
events { }
http {
    server {
        listen 80;

        location / {
            root /usr/share/nginx/html;
            try_files $uri $uri/ /Index.html =404;
        }
    }
}
```

Для получения дополнительной информации о конфигурации веб-сервера Nginx смотрите [Создание файлов конфигурации NGINX Plus и NGINX](https://docs.nginx.com/nginx/admin-guide/basic-functionality/managing-configuration-files/).

#### Nginx в Docker

Чтобы разместить Blazor в Docker с помощью Nginx, настройте файл Docker для использования образа Nginx на основе Alpine. Обновите файл Docker, чтобы скопировать файл *nginx.config* в контейнер.

Добавьте строки в файл Docker, как показано в следующем примере:

```
FROM nginx:alpine
COPY ./bin/Release/netstandard2.0/publish /usr/share/nginx/html/
COPY nginx.conf /etc/nginx/nginx.conf
```

#### GitHub Pages

Чтобы обрабатывать перезапись URL, добавьте файл *404.html* со сценарием, который обрабатывает перенаправление запроса на страницу *index.html*. Для примера реализации, представленной сообществом, смотрите [Single Page Apps for GitHub Pages](http://spa-github-pages.rafrex.com/) ([rafrex/spa-github-pages on GitHub](https://github.com/rafrex/spa-github-pages#readme)). Пример использования сообществом можно увидеть на [blazor-demo/blazor-demo.github.io в GitHub](https://github.com/blazor-demo/blazor-demo.github.io) ([живой сайт](https://blazor-demo.github.io/)).

При использовании сайта проекта вместо сайта организации добавьте или обновите **&lt;base&gt;** тег в файле *index.html*. установите значение атрибута `href` как `<repository-name>/`, где `<repository-name>/` это имя репозитория GitHub.
